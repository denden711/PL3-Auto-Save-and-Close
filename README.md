# PL3 Auto Save and Close

## 概要

このプロジェクトは、指定したディレクトリ内のすべての `.pl3` ファイルを自動的に開き、上書き保存ボタン、上書き保存の確認ボタン、および閉じるボタンをクリックするスクリプトです。二つのスクリプトに分かれており、最初にボタンの相対座標を取得し、次にその座標を使って自動化を行います。上書き保存が成功したかを確認し、成功しなかった場合は再試行します。また、処理の進行状況とエラーメッセージをログに記録します。

## 依存関係

以下のPythonライブラリが必要です：

- `pyautogui`
- `pygetwindow`
- `tkinter`（標準ライブラリ）
- `json`（標準ライブラリ）
- `logging`（標準ライブラリ）

依存関係をインストールするには、以下のコマンドを使用してください：

```sh
pip install pyautogui pygetwindow
```

## セットアップ

### 座標取得スクリプトの実行

1. `get_relative_coordinates.py` スクリプトを実行します：
    ```sh
    python get_relative_coordinates.py
    ```
2. スクリプトを実行すると、開いているウィンドウのタイトルを選択するダイアログが表示されます。
3. 操作対象のウィンドウを選択します。
4. 各ボタン（上書き保存ボタン、上書き保存の確認ボタン、閉じるボタン）の位置にマウスを移動させ、座標を取得します。
5. 座標は `coords.json` ファイルに保存されます。

### 自動化スクリプトの実行

1. `pl3_auto_save_and_close.py` スクリプトを実行します：
    ```sh
    python pl3_auto_save_and_close.py
    ```
2. スクリプトを実行すると、処理対象の `.pl3` ファイルが含まれるディレクトリを選択するダイアログが表示されます。
3. ディレクトリを選択します。
4. スクリプトがディレクトリ内のすべての `.pl3` ファイルを順次処理し、上書き保存ボタン、上書き保存の確認ボタン、閉じるボタンをクリックします。

## 使用方法

1. **座標取得スクリプト**:
    - 各ボタンの相対座標を取得し、`coords.json` ファイルに保存します。

2. **自動化スクリプト**:
    - 保存された座標を使用して、自動的に各ボタンをクリックします。

## エラーハンドリング

- **座標取得スクリプト**:
    - ウィンドウが取得できない場合、エラーメッセージを表示して終了します。
    - 選択されたウィンドウが見つからない場合、エラーメッセージを表示して終了します。
    - 座標取得中にエラーが発生した場合、エラーメッセージを表示して終了します。
    - 座標保存中にエラーが発生した場合、エラーメッセージを表示して終了します。

- **自動化スクリプト**:
    - `coords.json` の読み込みに失敗した場合、エラーメッセージを表示して終了します。
    - ディレクトリ選択がキャンセルされた場合、エラーメッセージを表示して終了します。
    - ファイルオープン中にエラーが発生した場合、エラーメッセージを表示して次のファイルに進みます。
    - ウィンドウ取得中にエラーが発生した場合、エラーメッセージを表示して次のファイルに進みます。
    - ウィンドウ位置取得中にエラーが発生した場合、エラーメッセージを表示して次のファイルに進みます。
    - ボタンクリック中にエラーが発生した場合、エラーメッセージを表示して次のファイルに進みます。
    - 上書き保存が成功しなかった場合、最大3回まで再試行します。

## 注意点

- 座標はディスプレイの解像度やウィンドウの配置に依存するため、異なる環境で実行する場合は再度座標を取得する必要があります。
- スクリプトの待ち時間（`time.sleep`）は、実行環境に応じて適宜調整してください。
- ログファイル（`pl3_processing.log`）に処理の進行状況とエラーメッセージが記録されます。

## ライセンス

このプロジェクトは、個人利用のためフリーです。